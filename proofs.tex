%!TEX root = main.tex
\section*{Proofs}
\begin{proof}[Proof of Theorem \ref{thm:asymp}]
By a mean-value expansion around $(\theta_0,\gamma_0)$,
	$$\sqrt{n}\left(\widehat{\beta}(b,c) - \beta_0^{(b)}\right) = - K(b,c)\Xi_c \sqrt{n} f_n(\theta_0,\gamma_0) + o_p(1)$$
  and by Assumption \ref{assump:high-level},
$\sqrt{n} f_n(\theta_0, \gamma_0) - \sqrt{n}E\left[f(Z_{ni},\theta_0, \gamma_0) \right]\overset{d}{\rightarrow} (\mathscr{N}_g', \mathscr{N}_h')'$. 
Now, by a mean-value expansion around $\gamma_n$,
	\begin{align*}
		\sqrt{n}E\left[ f(Z_{ni}, \theta_0,\gamma_0) \right] &= \sqrt{n}E\left[ f(Z_{ni}, \theta_0, \gamma_n) \right] + \sqrt{n}\nabla_{\gamma'}E\left[ f(Z_{ni}, \theta_0,\bar{\gamma}) \right] (\gamma_0 -\gamma_n)\\
			&=\left(\left[ \begin{array}{c} 0\\ \tau\end{array}\right] - \nabla_{\gamma'}E\left[ f(Z_{ni}, \theta_0, \bar{\gamma}) \right] \delta\right) \rightarrow \left(\left[ \begin{array}{c} 0\\ \tau\end{array}\right] - F_\gamma\delta\right)
	\end{align*}
  so $\sqrt{n}f_n(\theta_0, \gamma_0) \overset{d}{\rightarrow} \mathscr{N} + (0', \tau')' - F_\gamma \delta$.
  The result follows by the continuous mapping theorem.
\end{proof}

\begin{proof}[Proof of Corollary \ref{cor:valid}]
Since $\Xi_c$ picks out only the components corresponding to $g$,
	$$\Xi_c \left(\left[\begin{array}{c} \mathscr{N}_g\\  \mathscr{N}_h\end{array}\right]+ \left[ \begin{array}{c} 0\\ \tau\end{array}\right] - F_\gamma\delta\right) =  \mathscr{N}_g - G_\gamma \delta.$$
Thus, $\sqrt{n}\left( \widehat{\beta}_v - \beta_0 \right) \overset{d}{\rightarrow} -K_v\left(\mathscr{N}_g - G_\gamma \delta\right)$.
Finally, by the definition of a matrix inverse,
	\begin{align*}
		K_v G_\gamma \delta
    &= \left(\left[\begin{array}{c}G_\theta' \\ G_\gamma'\end{array}\right] W_{gg} \left[\begin{array}{cc} G_\theta & G_\gamma \end{array}\right] \right)^{-1} \left[\begin{array}{c}G_\theta' \\ G_\gamma'\end{array}\right]W_{gg} G_\gamma\delta\\ \\
			&= \left[\begin{array}{cc} 
				G_\theta'W_{gg}G_\theta & G_\theta'W_{gg}G_\gamma\\
				G_\gamma'W_{gg}G_\theta & G_\gamma'W_{gg}G_\gamma
			\end{array} \right]^{-1}
			\left[\begin{array}{c}
				G_\theta'W_{gg}G_\gamma\\
				G_\gamma'W_{gg}G_\gamma
			\end{array}\right]\delta =\left[\begin{array}{c} 0\\ \delta\end{array}\right].
	\end{align*}
\end{proof}


\begin{proof}[Proof of Corollary \ref{cor:mulimit}]
For some $\bar{\gamma}$ between $\gamma_0$ and $\gamma_n = \gamma_0 +\delta/\sqrt{n}$. 
		\[\mu_n  = \varphi(\theta_0, \gamma_0)+ \nabla_\gamma \varphi(\theta_0, \bar{\gamma})'(\gamma_n - \gamma_0) = \mu_0 + \nabla_\gamma \varphi(\theta_0, \bar{\gamma})' \delta/\sqrt{n}\]
by a mean-value expansion.
Hence, $\sqrt{n}(\mu_n - \mu_0) = \nabla_\gamma \varphi(\theta_0, \bar{\gamma})' \delta \rightarrow \nabla_\gamma \varphi(\theta_0, \gamma_0)' \delta$.
The result follows since $\sqrt{n}\left(\widehat{\mu}(b,c) - \mu_n \right)  = \sqrt{n}\left( \widehat{\mu}(b,c) - \mu_0 \right) - \sqrt{n}\left(\mu_n - \mu_0\right)$.
\end{proof}


\begin{proof}[Proof of Corollary \ref{cor:muvalid}]
The result follows from Corollaries \ref{cor:valid} and \ref{cor:mulimit} since,
	\begin{eqnarray*}
		\sqrt{n}\left( \widehat{\mu}_v - \mu_n\right) &\overset{d}{\rightarrow}&\nabla_\beta\varphi_0' \left\{ \left[\begin{array}{c} 0\\ \delta \end{array}\right] -K_v\mathscr{N}_g  \right\}-\nabla_\gamma \varphi_0' \delta\\ 
			&=& -\nabla_\beta\varphi_0' K_v\mathscr{N}_g + \left[\begin{array}{cc} \nabla_\theta\varphi_0'  & \nabla_\gamma\varphi_0' \end{array}\right]\left[\begin{array}{c} 0\\ \delta\end{array}\right]-\nabla_\gamma \varphi_0' \delta = -\nabla_\beta(\gamma_0,\theta_0)' K_v\mathscr{N}_g.
	\end{eqnarray*}
\end{proof}

\begin{proof}[Proof of Corollary \ref{cor:deltahat}]
  The result follows immediately from Corollary \ref{cor:valid}.
\end{proof}

\begin{proof}[Proof of Lemma \ref{lem:tauhatasymp}]
By a mean-value expansion around $\beta_0 = ( \theta_0', \gamma_0')'$,
\[
  \sqrt{n}h_n\left(\widehat{\beta}_v \right) = \sqrt{n}h_n(\beta_0) + H \sqrt{n} \left(\widehat{\beta}_v - \beta_0\right) + o_p(1).
\]
Now, since
\[
  \sqrt{n}f_n(\theta_0, \gamma_0) \overset{d}{\rightarrow} \left[\begin{array}{c} \mathscr{N}_g\\  \mathscr{N}_h\end{array}\right]+ \left[ \begin{array}{c} 0\\ \tau\end{array}\right] - \left[\begin{array}{c}G_\gamma\\ H_\gamma \end{array}\right]\delta
\]
we have $\sqrt{n}h_n(\theta_0, \gamma_0)\overset{d}{\rightarrow} \mathscr{N}_h + \tau - H_\gamma \delta$.
Substituting, 
	\begin{align*}
		\sqrt{n}h_n(\widehat{\beta}_v) &\overset{d}{\rightarrow}  \mathscr{N}_h + \tau - H_\gamma \delta+ H\left( -K_v \mathscr{N}_g + \left[\begin{array}{c} 0 \\ \delta \end{array} \right]\right)
			%&= \mathscr{N}_h + \tau - H_\gamma \delta - HK_v \mathscr{N}_g + \left[ \begin{array}{cc} H_\theta & H_\gamma \end{array}\right] \left[\begin{array}{c} 0 \\ \delta \end{array} \right]\\
			%&= \mathscr{N}_h  + \tau - H_\gamma \delta - HK_v \mathscr{N}_g  + H_\gamma \delta\\
			= \tau - HK_v \mathscr{N}_g + \mathscr{N}_h.
	\end{align*}
\end{proof}

\begin{proof}[Proof of Corollary \ref{cor:biasestimators}]
  Define $(U', V')' = (\delta', \tau')' + \Psi (\mathscr{N}_g', \mathscr{N}_h')'$. 
	%$$\left[\begin{array}{c} U\\ V \end{array}\right]=\left[\begin{array}{c}\delta\\ \tau\end{array} \right] +\Psi\left[\begin{array}{c}\mathscr{N}_g \\ \mathscr{N}_h \end{array}\right].$$
By the Continuous Mapping Theorem and Theorem \ref{thm:jointbias},
	$$\left[\begin{array}{c} \widehat{\delta} \\ \widehat{\tau} \end{array}\right]\left[\begin{array}{cc} \widehat{\delta}' & \widehat{\tau}'\end{array} \right] \overset{d}{\rightarrow} \left[\begin{array}{c} U\\V \end{array}\right]\left[\begin{array}{cc}U' & V'\end{array} \right] $$
  The result follows since $\Psi\Omega\Psi = E [(U', V')' (U', V')] - (\delta', \tau')' (\delta', \tau')$.
\end{proof}

\begin{proof}[Proof of Theorem \ref{thm:sim}]
To simplify the argument let $\xi = (\delta', \tau')'$ and $\mathscr{M} = \xi + \Psi \mathscr{N}$.
Now, let $a(\xi^*)$ and  $b(\xi^*)$ be quantiles of the distribution of $\Lambda$ calculated under the assumption that the true bias parameter $\xi$ is equal to $\xi^*$ such that $P\{a(\xi^*) \leq \Lambda(\xi^*)\leq b(\xi^*)\} = 1-\alpha_2$.
Define
\[
  a_{min}(\mathscr{M}) = \min\left\{a(\xi^*) \colon \xi^* \in \mathscr{R}(\mathscr{M}|\alpha_1)  \right\}, \quad
  b_{max}(\mathscr{M}) = \max\left\{b(\xi^*) \colon \xi^* \in \mathscr{R}(\mathscr{M}|\alpha_1)  \right\}
\]
and
\[
  \mathscr{R}(\mathscr{M}|\alpha_1) = \left\{ \xi^* \colon \left[\left(\mathscr{M} - \xi^*\right)' \left( \Psi \Omega \Psi' \right)^{-1}\left( \mathscr{M} - \xi^* \right)\right] \leq \chi^2_{p+q}(\alpha_1) \right\}
\]
where $\chi_{p+q}^2(\alpha_1)$ is the $1-\alpha_1$ quantile of a $\chi_{p+q}^2$ distribution. 
By Theorem \ref{thm:jointbias} and Corollary \ref{cor:avg}, 
\[
P\{ \mu_0 \in CI_{sim}\} \rightarrow P\{ a_{min} \leq \Lambda(\delta, \tau) \leq b_{max}\}.
\]
Let $A = \left \{\xi \in \mathscr{R}(\mathscr{M}|\alpha_1) \right\}$.
By construction $P(A) = 1 - \alpha_1$.
Decomposing $P\left\{ a(\xi^*) \leq \Lambda(\xi^*) \leq b(\xi^*)  \right\}$ into the sum of mutually exclusive events, we have
\[
P\left[\left\{ a(\xi^*) \leq \Lambda(\xi^*) \leq b(\xi^*)  \right\} \cap A \right] + P\left[\left\{ a(\xi^*) \leq \Lambda(\xi^*) \leq b(\xi^*)  \right\} \cap A^c \right] = 1-\alpha_2
\]
for every $\xi \in \mathscr{R}(\mathcal{M}|\alpha_1)$.
But since 
$P\left[\left\{ a(\xi^*) \leq \Lambda(\xi^*) \leq b(\xi^*)  \right\} \cap A^c \right] \leq P(A^c) = \alpha_1$,
we see that
$P\left[\left\{ a(\xi^*) \leq \Lambda(\xi^*) \leq b(\xi^*)  \right\} \cap A \right] \geq 1- \alpha_1 - \alpha_2$,
for every $\xi^* \in \mathscr{R}(\mathscr{M}|\alpha_1)$.
By definition, if $A$ occurs then $\xi \in \mathscr{R}(\mathscr{M}|\alpha_1)$ and hence 
$P\left[\left\{ a(\xi) \leq \Lambda(\xi) \leq b(\xi)  \right\} \cap A \right] \geq 1- \alpha_1 - \alpha_2$.
But when $\xi^* \in  \mathscr{R}(\mathscr{M}|\alpha_1)$ we have
$a_{min} \leq a(\xi)$ and $b(\xi) \leq b_{max}$. It follows that 
\[
\left \{ a(\xi) \leq \Lambda (\xi) \leq b(\xi) \right \} \cap A \subseteq \left\{ a_{min} \leq \Lambda (\xi) \leq b_{max}\right \}
\]
and therefore
$1-\alpha_1 - \alpha_2 \leq P\left[\left \{ a(\xi) \leq \Lambda (\xi) \leq b(\xi) \right \} \cap A  \right]
\leq P\left[ a_{min} \leq \Lambda(\xi) \leq b_{max} \right]$.
\end{proof}


\begin{proof}[Proof of Theorem \ref{thm:limitDpanel}.]
  This proof is standard, so we provide only a sketch.
Expanding, 
\begin{align*}
  \sqrt{n}\left[\widehat{\beta}(k,\cdot) - \beta\right] &=(0, \mathbf{0}_{k-m}', \boldsymbol{\delta}')' + \widehat{Q}(k,\cdot)\left[ n^{-1/2}Z'(k,\cdot)\Delta \mathbf{v}\right]\\
  \sqrt{n}\left[\widehat{\beta}(r,\cdot) - \beta_{r}\right] &=  \widehat{Q}(r,\cdot)\left\{  \left[n^{-1}Z'(r,\cdot)( L^{k-m+1}\Delta \mathbf{y}^+ , \ldots,  L^{k}\Delta \mathbf{y}^+)\boldsymbol{\delta}\right] + \left[n^{-1/2}Z'(r,\cdot)\Delta \mathbf{v}^{+}\right] \right\}
\end{align*}
The result follows by applying the Lindeberg-Feller CLT to $n^{-1/2}Z'(k,\cdot)\Delta \mathbf{v}$ and $n^{-1/2}Z'(r,\cdot)\Delta \mathbf{v}^{+}$ and an appropriate law of large numbers to each element of $n^{-1} Z'(r,\cdot)(L^{k-m+1} \Delta \mathbf{y}^{+}, \ldots, L^k \Delta \mathbf{y}^{+})$, where $(\cdot)$ is either $\text{P}$ or $\text{S}$ depending on the instrument set used.
\end{proof}


\begin{proof}[Proof of Theorem \ref{thm:DpanelJoint}]
  Expanding $\widehat{\beta}(k,\text{P})$ from Equation \ref{eq:DpanelEstimators} 
  \begin{align*}
    n^{-1/2}X'\left[ \Delta \mathbf{y} - W(k)\widehat{\beta}(k,\text{P})  \right] 
    %&= n^{-1/2}X'\left\{ \left[W(k) \beta_n + \Delta \mathbf{v}\right] - W(k) \left[ \beta_n + \widehat{Q}(k,\text{P}) n^{-1} Z'(k,\text{P})\Delta \mathbf{v} \right] \right\} \\
    &= n^{-1/2}X'\left[ \Delta \mathbf{v}  - W(k)\, \widehat{Q}(k,\text{P}) \, n^{-1} Z'(k,\text{P})\Delta \mathbf{v}\right] \\
    %&= n^{-1/2}X'\Delta \mathbf{v}  - n^{-1}X'W(k)\,\widehat{Q}(k,\text{P})\left[ n^{-1/2} Z'(k,\text{P})\Delta \mathbf{v}\right]\\
    &= \left[
    \begin{array}{cc}
      -n^{-1} X'W(k) \, \widehat{Q}(k,\text{P}) & I_{T-k-1}
    \end{array}
  \right] 
  \left[
  \begin{array}{c}
    n^{-1/2}Z'(k,\text{P}) \Delta \mathbf{v} \\
    n^{-1/2} X' \Delta \mathbf{v}
  \end{array}
\right]
  \end{align*}
  using $\Delta \mathbf{y} = W(k) \beta_n + \Delta \mathbf{v}$. 
  Similarly, expanding $\widehat{\beta}(k,\text{P})$ from Equation \ref{eq:DpanelEstimators},
  \[
    \sqrt{n}\left[ \widehat{\beta}(k,\text{P}) \right] = \left[
    \begin{array}{ccc}
      0 & \mathbf{0}_{k-m}' & \boldsymbol{\delta}'  
    \end{array}
  \right]' + \widehat{Q}(k,\text{P}) n^{-1/2}Z'(k,\text{P}) \Delta \mathbf{v}
  \]
  and since $\widehat{\boldsymbol{\delta}}$ is $\sqrt{n}$ times the last $m$ elements of $\widehat{\beta}(k,\text{P})$ and the last $m$ elements of $\beta$ is zero, we have
  \[
    \widehat{\boldsymbol{\delta}} = \boldsymbol{\delta} + \left[
    \begin{array}{ccc}
    0 & \mathbf{0}'_{k-m} & \boldsymbol{\iota}_m'  
    \end{array}
  \right]' \widehat{Q}(k,\text{P}) n^{-1/2} Z'(k,\text{P})\Delta \mathbf{v}.
  \]
  By a law of large numbers $\widehat{Q}(k,\text{P}) \rightarrow_p Q(k,\text{P})$ and $n^{-1}X'W(k) \rightarrow_p \boldsymbol{\xi}' \otimes \boldsymbol{\iota}_{T-k-1}$, hence 
  \[
    \left[
    \begin{array}{c}
      \widehat{\boldsymbol{\delta}} - \boldsymbol{\delta} \\ \widehat{\tau}
    \end{array}
  \right] = \Psi
  \left[
  \begin{array}{c}
    n^{-1/2}Z'(k,\text{P}) \Delta \mathbf{v} \\
    n^{-1/2} X' \Delta \mathbf{v}
  \end{array}
\right] + o_p(1).
  \]
  The result follows by applying the Lindeberg-Feller CLT jointly to $n^{-1/2}Z'(k,\text{P})\Delta\mathbf{v}$ and $n^{-1/2}X'\Delta \mathbf{v}$ and noting that $\Pi$ maps $[n^{-1/2}Z'(k,\text{S})\Delta \mathbf{v}]$ to $\left[
  \begin{array}{cc}
    \left\{n^{-1/2} Z'(k,P)\Delta \mathbf{v}\right\}' &
    \left\{n^{-1/2} X'\Delta \mathbf{v}\right\}' 
  \end{array}
\right]'.$
\end{proof}
